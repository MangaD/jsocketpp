<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>jsocketpp: Unit Testing and Integration Guide</title>
<link rel="icon" href="logo55px.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo55px.png"/></td>
  <td id="projectalign">
   <div id="projectname">jsocketpp<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">A cross-platform C++20 socket library.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__unit__tests.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Unit Testing and Integration Guide <div class="ingroups"><a class="el" href="group__docs.html">User Guides</a></div></div></div>
</div><!--header-->
<div class="contents">
<p>Unit and integration testing for a cross-platform C++20 socket library can be quite challenging, but with the right approach and tools, it can be done effectively. Here's a structured plan to guide you through setting up unit and integration tests for your library.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md472"></a>
1. <b>Unit Tests</b>:</h2>
<p>Unit tests for a socket library typically test individual components of the library in isolation. You will mock or simulate socket-related functionality in your unit tests to avoid real network activity.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md473"></a>
Tools for Unit Testing in C++20:</h3>
<ul>
<li><b>Google Test (gtest)</b>: This is one of the most popular C++ testing frameworks, providing powerful features such as assertions, fixtures, and mock support. It works seamlessly on both <b>Windows</b> and <b>Linux</b> and integrates easily into CMake.</li>
<li><b>Google Mock (gmock)</b>: This is an extension of Google Test that allows you to mock classes and methods. Useful for mocking socket behavior and testing edge cases where actual socket communication isn't needed.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md474"></a>
1.1 <b>Mocking Socket Behavior</b>:</h3>
<p>To unit test your socket library, youâ€™ll need to mock socket-related functions like <span class="tt">socket()</span>, <span class="tt">recv()</span>, <span class="tt">send()</span>, etc. This allows you to test your socket code without actually opening real network connections.</p>
<h4 class="doxsection"><a class="anchor" id="autotoc_md475"></a>
Example: Using Google Mock to Mock <span class="tt">recv</span> and <span class="tt">send</span>:</h4>
<ol type="1">
<li>Define a mock class for socket functions:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gmock/gmock.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MockSocket {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MOCK_METHOD(<span class="keywordtype">int</span>, recv, (<span class="keywordtype">int</span> sockfd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags), ());</div>
<div class="line">    MOCK_METHOD(<span class="keywordtype">int</span>, send, (<span class="keywordtype">int</span> sockfd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags), ());</div>
<div class="line">};</div>
</div><!-- fragment --><ol type="1">
<li>Use Google Test and Mock in your test cases:</li>
</ol>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;MockSocket.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MySocketTest : <span class="keyword">public</span> ::testing::Test {</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    MockSocket mockSocket;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">TEST_F(MySocketTest, TestSocketRead) {</div>
<div class="line">    <span class="comment">// Mock the recv function to return a fixed value</span></div>
<div class="line">    EXPECT_CALL(mockSocket, recv(::testing::_, ::testing::_, ::testing::_, ::testing::_))</div>
<div class="line">        .WillOnce(::testing::Return(5));  <span class="comment">// Simulate 5 bytes received</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Call the function in your library that uses recv</span></div>
<div class="line">    <span class="keywordtype">int</span> result = mySocketLibraryReadFunction(mockSocket);</div>
<div class="line"> </div>
<div class="line">    ASSERT_EQ(result, 5);  <span class="comment">// Assert that the result is as expected</span></div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md476"></a>
1.2 <b>Testing Socket Initialization and Cleanup</b>:</h3>
<p>You can test the initialization, error handling, and cleanup of sockets using mock or actual socket functions, but avoid creating real connections.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md477"></a>
2. <b>Integration Tests</b>:</h2>
<p>Integration tests test how components of the socket library interact with real resources (e.g., actual sockets, local servers, etc.). These tests typically involve starting up a real server and connecting with a client, or testing how the library handles real network connections in a controlled environment.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md478"></a>
2.1 <b>Setting Up Real Server and Client</b>:</h3>
<p>For integration testing, you'll want to set up a <b>TCP server</b> and <b>TCP client</b> that test the real communication.</p>
<ol type="1">
<li><b>Server Setup</b>: Use your socket library to implement a simple server that listens for incoming connections.</li>
<li><b>Client Setup</b>: Implement a client that connects to the server and sends/receives data.</li>
<li><b>Test Communication</b>: The integration tests will simulate actual network communication and ensure your library correctly handles socket connections, sends and receives data, and closes connections.</li>
</ol>
<h3 class="doxsection"><a class="anchor" id="autotoc_md479"></a>
Example of a Simple Server-Client Integration Test:</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;gtest/gtest.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Socket.h&quot;</span>  <span class="comment">// Your socket library</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Simple server that listens on a specific port</span></div>
<div class="line"><span class="keywordtype">void</span> startServer() {</div>
<div class="line">    ServerSocket server(8080);</div>
<div class="line">    server.listen();</div>
<div class="line">    Socket client = server.accept();  <span class="comment">// Accept a connection from the client</span></div>
<div class="line">    <span class="keywordtype">char</span> buffer[1024];</div>
<div class="line">    client.read(buffer, <span class="keyword">sizeof</span>(buffer));  <span class="comment">// Read the data sent from the client</span></div>
<div class="line">    client.write(<span class="stringliteral">&quot;ack&quot;</span>, 3);  <span class="comment">// Send an acknowledgment</span></div>
<div class="line">    client.close();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Simple client that connects to the server</span></div>
<div class="line"><span class="keywordtype">void</span> startClient() {</div>
<div class="line">    Socket client(<span class="stringliteral">&quot;127.0.0.1&quot;</span>, 8080);</div>
<div class="line">    client.write(<span class="stringliteral">&quot;hello&quot;</span>, 5);  <span class="comment">// Send a message to the server</span></div>
<div class="line">    <span class="keywordtype">char</span> buffer[1024];</div>
<div class="line">    client.read(buffer, <span class="keyword">sizeof</span>(buffer));  <span class="comment">// Read the server&#39;s acknowledgment</span></div>
<div class="line">    client.close();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><a class="code hl_function" href="socket__gtest_8cpp.html#af84a2f63791f9b4fd5ee14e6161ce2d9">TEST</a>(SocketIntegrationTest, TestServerClientCommunication) {</div>
<div class="line">    <span class="comment">// Run server in a separate thread</span></div>
<div class="line">    std::thread serverThread(startServer);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run client in the main thread</span></div>
<div class="line">    startClient();</div>
<div class="line"> </div>
<div class="line">    serverThread.join();  <span class="comment">// Ensure the server thread completes</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add assertions here, if necessary, to verify the data exchange</span></div>
<div class="line">}</div>
<div class="ttc" id="asocket__gtest_8cpp_html_af84a2f63791f9b4fd5ee14e6161ce2d9"><div class="ttname"><a href="socket__gtest_8cpp.html#af84a2f63791f9b4fd5ee14e6161ce2d9">TEST</a></div><div class="ttdeci">TEST(SocketTest, TcpConnectInvalid)</div><div class="ttdef"><b>Definition</b> socket_gtest.cpp:12</div></div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md480"></a>
3. <b>Test Coverage for Cross-Platform</b>:</h2>
<p>Since your library is cross-platform, it's important to ensure that tests work on both <b>Windows</b> and <b>Linux</b> (or other platforms). Here are a few strategies to ensure cross-platform testing:</p>
<ul>
<li><b>CMake Presets</b>: Use CMake presets to configure the build system for different platforms.</li>
<li><b>Docker</b>: For testing on Linux, you can use Docker containers to simulate different Linux environments.</li>
<li><b>CI/CD Pipelines</b>: Set up continuous integration (CI) pipelines to automatically run your tests on both Windows and Linux environments.</li>
</ul>
<p>For example, use <b>GitHub Actions</b>, <b>Travis CI</b>, or <b>AppVeyor</b> to run your tests on multiple platforms.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md481"></a>
3.1 <b>Using CMake for Platform-Specific Tests</b>:</h3>
<p>You can specify platform-specific configurations in your CMakeLists.txt to manage platform-specific test setups.</p>
<div class="fragment"><div class="line">if (WIN32)</div>
<div class="line">    add_executable(SocketTestWindows test_socket.cpp)</div>
<div class="line">    target_link_libraries(SocketTestWindows gtest gmock)</div>
<div class="line">    set_target_properties(SocketTestWindows PROPERTIES</div>
<div class="line">            COMPILE_DEFINITIONS &quot;PLATFORM_WINDOWS&quot;</div>
<div class="line">    )</div>
<div class="line">elseif (UNIX)</div>
<div class="line">    add_executable(SocketTestUnix test_socket.cpp)</div>
<div class="line">    target_link_libraries(SocketTestUnix gtest gmock)</div>
<div class="line">    set_target_properties(SocketTestUnix PROPERTIES</div>
<div class="line">            COMPILE_DEFINITIONS &quot;PLATFORM_LINUX&quot;</div>
<div class="line">    )</div>
<div class="line">endif ()</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md482"></a>
4. <b>Mocking or Stubbing Socket API for Unit Tests</b>:</h2>
<p>For unit tests where you don't want to deal with actual network communication, you can mock socket calls like <span class="tt">socket()</span>, <span class="tt">recv()</span>, <span class="tt">send()</span>, and <span class="tt">close()</span> to simulate different network conditions.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md483"></a>
Mock Example with Google Mock:</h3>
<div class="fragment"><div class="line"><span class="keyword">class </span>MockSocketAPI {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MOCK_METHOD(<span class="keywordtype">int</span>, socket, (<span class="keywordtype">int</span> domain, <span class="keywordtype">int</span> type, <span class="keywordtype">int</span> protocol), ());</div>
<div class="line">    MOCK_METHOD(<span class="keywordtype">int</span>, send, (<span class="keywordtype">int</span> sockfd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags), ());</div>
<div class="line">    MOCK_METHOD(<span class="keywordtype">int</span>, recv, (<span class="keywordtype">int</span> sockfd, <span class="keywordtype">void</span> *buf, <span class="keywordtype">size_t</span> len, <span class="keywordtype">int</span> flags), ());</div>
<div class="line">    MOCK_METHOD(<span class="keywordtype">int</span>, close, (<span class="keywordtype">int</span> sockfd), ());</div>
<div class="line">};</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md484"></a>
4.1 <b>Integration Test with Mocking</b>:</h3>
<p>You can mock system calls for a more controlled environment during unit tests. This way, you can simulate various network conditions without needing a live server or network connection.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md485"></a>
5. <b>Test Cases to Consider</b>:</h2>
<p>Here are some potential test cases for your socket library:</p>
<ul>
<li><b>Connection Tests</b>:<ul>
<li>Can you successfully connect a client to a server?</li>
<li>What happens when the server is unavailable?</li>
<li>Can the server handle multiple simultaneous clients?</li>
</ul>
</li>
<li><b>Timeouts</b>:<ul>
<li>Does the socket properly handle timeouts for both reading and writing?</li>
</ul>
</li>
<li><b>Data Handling</b>:<ul>
<li>Can the socket send and receive data reliably?</li>
<li>Does the socket handle large data transfers?</li>
</ul>
</li>
<li><b>Error Handling</b>:<ul>
<li>What happens when an invalid socket is used?</li>
<li>Does the library throw exceptions for failed operations?</li>
</ul>
</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md486"></a>
Conclusion:</h2>
<ul>
<li><b>Unit Tests</b>: Mock socket functions to test socket operations in isolation without actual network communication.</li>
<li><b>Integration Tests</b>: Set up real server-client communication to test the full flow of data over TCP connections.</li>
<li><b>Cross-Platform Support</b>: Ensure your tests work on both <b>Windows</b> and <b>Linux</b> by using CI/CD tools and platform-specific build configurations.</li>
</ul>
<p>By leveraging <b>Google Test</b>, <b>Google Mock</b>, and <b>CI pipelines</b>, you can ensure your cross-platform socket library is robust and works as expected across different systems.</p>
<p>Let me know if you need further help or more examples! </p>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
