<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>jsocketpp: Comprehensive Guide to &lt;tt&gt;ioctl&lt;/tt&gt;, &lt;tt&gt;fcntl&lt;/tt&gt;, &lt;tt&gt;ioctlsocket&lt;/tt&gt;, &lt;tt&gt;WSAIoctl&lt;/tt&gt;, and Related Functions: Commands, Use Cases, and Windows Support</title>
<link rel="icon" href="logo55px.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo55px.png"/></td>
  <td id="projectalign">
   <div id="projectname">jsocketpp<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">A cross-platform C++20 socket library.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('group__ioctl__fcntl__ioctlsocket__guide.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Comprehensive Guide to <span class="tt">ioctl</span>, <span class="tt">fcntl</span>, <span class="tt">ioctlsocket</span>, <span class="tt">WSAIoctl</span>, and Related Functions: Commands, Use Cases, and Windows Support <div class="ingroups"><a class="el" href="group__docs.html">User Guides</a></div></div></div>
</div><!--header-->
<div class="contents">
<p><a href="https://creativecommons.org/publicdomain/zero/1.0/"><img src="https://licensebuttons.net/p/zero/1.0/88x31.png" alt="CC0" class="inline"/></a></p>
<p><em>Disclaimer: Grok generated document</em>.</p>
<p>Below is a comprehensive exploration of the <span class="tt">ioctl</span>, <span class="tt">fcntl</span>, <span class="tt">ioctlsocket</span>, <span class="tt">WSAIoctl</span>, and related functions, diving into their details, commands, use cases, and support across Windows versions, including Windows XP. Given the request for exhaustive detail, this response covers their functionality, historical context, common commands, practical examples, and platform-specific nuances, with a focus on Windows compatibility.</p>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md224"></a>
Overview of Functions</h2>
<p>These functions are low-level interfaces for controlling and configuring file descriptors or sockets, primarily in Unix-like systems (<span class="tt">ioctl</span>, <span class="tt">fcntl</span>) and Windows (<span class="tt">ioctlsocket</span>, <span class="tt">WSAIoctl</span>). They are used to perform operations not covered by standard I/O functions like <span class="tt">read</span> or <span class="tt">write</span>, such as setting non-blocking modes, querying device states, or configuring network interfaces. Each function has a specific scope, with overlapping but distinct purposes.</p>
<ul>
<li><b>ioctl (Unix/Linux)</b>: A general-purpose system call for device-specific I/O control, used for character devices, sockets, and other special files.</li>
<li><b>fcntl (Unix/Linux)</b>: A versatile system call for file descriptor operations, including file control, locking, and some I/O control tasks overlapping with <span class="tt">ioctl</span>.</li>
<li><b>ioctlsocket (Windows)</b>: A Winsock function for socket-specific I/O control, supporting a subset of Berkeley socket ioctls.</li>
<li><b>WSAIoctl (Windows)</b>: An extended Winsock function for broader socket control, including Windows-specific and BSD-compatible operations.</li>
<li><b>Related Functions</b>: Functions like <span class="tt">setsockopt</span>/<span class="tt">getsockopt</span>, <span class="tt">tcsetattr</span>/<span class="tt">tcgetattr</span>, and sysfs interfaces in Linux, which overlap or replace these functions in specific contexts.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md226"></a>
1. ioctl (Unix/Linux)</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md227"></a>
Description</h3>
<p><span class="tt">ioctl</span> (Input/Output Control) is a system call in Unix-like systems (Linux, BSD, etc.) for performing device-specific operations on file descriptors, especially for character devices (e.g., terminals, serial ports, network interfaces). It’s a catch-all for operations that don’t fit standard file I/O, such as configuring hardware, querying status, or executing driver-specific commands. It’s highly flexible but device-dependent, making it non-portable and complex.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md228"></a>
Syntax</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="keywordtype">int</span> ioctl(<span class="keywordtype">int</span> fd, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> request, ...);</div>
</div><!-- fragment --><ul>
<li><b>fd</b>: Open file descriptor (from <span class="tt">open(2)</span>) for a device or socket.</li>
<li><b>request</b>: Device-specific operation code, typically defined using macros like <span class="tt">_IO</span>, <span class="tt">_IOR</span>, <span class="tt">_IOW</span>, <span class="tt">_IOWR</span> from <span class="tt">&lt;asm/ioctl.h&gt;</span>.</li>
<li><b>... (arg)</b>: Optional argument, usually a pointer to data (e.g., <span class="tt">void *</span>), but can be an integer or other type depending on the request.</li>
</ul>
<p>On some systems (e.g., musl libc), the second argument is <span class="tt">int</span> instead of <span class="tt">unsigned long</span>.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md229"></a>
Request Code Structure</h3>
<p>Request codes are 32-bit values (in Linux) with fields:</p>
<ul>
<li><b>Direction</b> (2 bits): 0 (none), 1 (write), 2 (read), 3 (read/write).</li>
<li><b>Size</b> (14 bits): Size of the argument data (e.g., <span class="tt">sizeof(struct)</span>).</li>
<li><b>Type</b> (8 bits): Magic number (e.g., 'T' for terminals).</li>
<li><b>Number</b> (8 bits): Serial number for the command.</li>
</ul>
<p>Macros to define requests:</p>
<ul>
<li><span class="tt">_IO(type, nr)</span>: No data transfer.</li>
<li><span class="tt">_IOR(type, nr, type)</span>: Read from kernel to user.</li>
<li><span class="tt">_IOW(type, nr, type)</span>: Write from user to kernel.</li>
<li><span class="tt">_IOWR(type, nr, type)</span>: Bidirectional.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md230"></a>
Return Values</h3>
<ul>
<li><b>Success</b>: 0 or a positive value (e.g., bytes processed).</li>
<li><b>Failure</b>: -1, with <span class="tt">errno</span> set (e.g., <span class="tt">EBADF</span>, <span class="tt">EFAULT</span>, <span class="tt">EINVAL</span>, <span class="tt">ENOTTY</span>).</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md231"></a>
Common Errors</h3>
<ul>
<li><span class="tt">EBADF</span>: Invalid file descriptor.</li>
<li><span class="tt">EFAULT</span>: <span class="tt">arg</span> points to inaccessible memory.</li>
<li><span class="tt">EINVAL</span>: Invalid <span class="tt">request</span> or <span class="tt">arg</span>.</li>
<li><span class="tt">ENOTTY</span>: <span class="tt">fd</span> not a character device or operation inapplicable.</li>
<li><span class="tt">EIO</span>: I/O error.</li>
<li><span class="tt">ENXIO</span>: Device-specific sub-device error.</li>
<li>POSIX STREAMS errors: <span class="tt">EINTR</span>, <span class="tt">ENOSR</span>, etc.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md232"></a>
Common Commands</h3>
<ul>
<li><b>Terminal/Console</b>:<ul>
<li><span class="tt">TIOCGWINSZ</span>: Get terminal window size (<span class="tt">struct winsize</span>).</li>
<li><span class="tt">TIOCSWINSZ</span>: Set window size.</li>
<li><span class="tt">TIOCSETD</span>: Set line discipline.</li>
<li><span class="tt">TIOCSCTTY</span>: Set controlling terminal.</li>
</ul>
</li>
<li><b>Sockets</b>:<ul>
<li><span class="tt">FIONBIO</span>: Set/clear non-blocking mode (non-zero to enable).</li>
<li><span class="tt">FIONREAD</span>: Get number of readable bytes.</li>
<li><span class="tt">SIOCGIFADDR</span>: Get network interface address.</li>
<li><span class="tt">SIOCSIFADDR</span>: Set interface address.</li>
<li><span class="tt">SIOCGIFMTU</span>: Get MTU size.</li>
</ul>
</li>
<li><b>Disk/Storage</b>:<ul>
<li><span class="tt">HDIO_GETGEO</span>: Get disk geometry.</li>
<li><span class="tt">BLKGETSIZE</span>: Get block device size.</li>
</ul>
</li>
<li><b>Custom Drivers</b>: User-defined via <span class="tt">_IO*</span> macros for kernel modules.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md233"></a>
Use Cases</h3>
<ul>
<li><b>Terminal Management</b>: Adjusting terminal settings (e.g., window size for <span class="tt">tmux</span> or <span class="tt">vim</span>).</li>
<li><b>Network Configuration</b>: Setting IP addresses, MTU, or querying interface status.</li>
<li><b>Device Drivers</b>: Controlling hardware (e.g., serial ports, GPUs).</li>
<li><b>Kernel Modules</b>: Custom ioctls for proprietary hardware.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md234"></a>
Example: Terminal Window Size (Linux)</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    <span class="keyword">struct </span>winsize ws;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(STDIN_FILENO, TIOCGWINSZ, &amp;ws) == -1) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;ioctl&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Terminal size: %d rows x %d columns\n&quot;</span>, ws.ws_row, ws.ws_col);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aclient_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> client.cpp:89</div></div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md235"></a>
Example: Custom Device Driver (Linux)</h3>
<p>User-space code interacting with a kernel module:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#define MY_MAGIC &#39;a&#39;</span></div>
<div class="line"><span class="preprocessor">#define WR_VALUE _IOW(MY_MAGIC, 1, int)</span></div>
<div class="line"><span class="preprocessor">#define RD_VALUE _IOR(MY_MAGIC, 2, int)</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    <span class="keywordtype">int</span> fd = open(<span class="stringliteral">&quot;/dev/mydevice&quot;</span>, O_RDWR);</div>
<div class="line">    <span class="keywordflow">if</span> (fd &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;open&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">int</span> value = 42;</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd, WR_VALUE, &amp;value) == -1) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;ioctl write&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (ioctl(fd, RD_VALUE, &amp;value) == -1) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;ioctl read&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Read value: %d\n&quot;</span>, value);</div>
<div class="line">    }</div>
<div class="line">    close(fd);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Kernel-side (simplified):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;linux/module.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;linux/fs.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;linux/uaccess.h&gt;</span></div>
<div class="line"><span class="preprocessor">#define MY_MAGIC &#39;a&#39;</span></div>
<div class="line"><span class="preprocessor">#define WR_VALUE _IOW(MY_MAGIC, 1, int)</span></div>
<div class="line"><span class="preprocessor">#define RD_VALUE _IOR(MY_MAGIC, 2, int)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> value;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">long</span> device_ioctl(<span class="keyword">struct</span> file *file, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cmd, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg) {</div>
<div class="line">    <span class="keywordtype">int</span> temp;</div>
<div class="line">    <span class="keywordflow">switch</span> (cmd) {</div>
<div class="line">        <span class="keywordflow">case</span> WR_VALUE:</div>
<div class="line">            <span class="keywordflow">if</span> (copy_from_user(&amp;temp, (<span class="keywordtype">int</span> __user *)arg, <span class="keyword">sizeof</span>(temp)))</div>
<div class="line">                <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line">            value = temp;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> RD_VALUE:</div>
<div class="line">            <span class="keywordflow">if</span> (copy_to_user((<span class="keywordtype">int</span> __user *)arg, &amp;value, <span class="keyword">sizeof</span>(value)))</div>
<div class="line">                <span class="keywordflow">return</span> -EFAULT;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">return</span> -ENOTTY;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>file_operations fops = {</div>
<div class="line">    .unlocked_ioctl = device_ioctl,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> __init my_init(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="keywordflow">return</span> register_chrdev(0, <span class="stringliteral">&quot;mydevice&quot;</span>, &amp;fops);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> __exit my_exit(<span class="keywordtype">void</span>) {</div>
<div class="line">    unregister_chrdev(0, <span class="stringliteral">&quot;mydevice&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">module_init(my_init);</div>
<div class="line">module_exit(my_exit);</div>
<div class="line">MODULE_LICENSE(<span class="stringliteral">&quot;GPL&quot;</span>);</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md236"></a>
Windows Support</h3>
<p><span class="tt">ioctl</span> is not supported on Windows, as it’s a Unix-specific system call. Windows uses device I/O control via <span class="tt">DeviceIoControl</span> for similar purposes, but it’s not a direct equivalent and uses different semantics.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md237"></a>
Notes</h3>
<ul>
<li><b>Portability</b>: Varies across Unix systems; Linux uses <span class="tt">_IO*</span> macros, while BSD may differ. POSIX defines <span class="tt">ioctl</span> for STREAMS (obsolescent).</li>
<li><b>Alternatives</b>: sysfs, netlink, or specific syscalls like <span class="tt">tcsetattr</span> in Linux.</li>
<li><b>Security</b>: Kernel-side validation is critical to avoid crashes or escalations.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md239"></a>
2. fcntl (Unix/Linux)</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md240"></a>
Description</h3>
<p><span class="tt">fcntl</span> (File Control) is a Unix system call for manipulating file descriptor attributes, including file status flags, locks, and some I/O controls. It overlaps with <span class="tt">ioctl</span> for socket operations (e.g., non-blocking mode) but is more general for file operations. It’s part of POSIX and more portable than <span class="tt">ioctl</span>.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md241"></a>
Syntax</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="keywordtype">int</span> fcntl(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> cmd, ...);</div>
</div><!-- fragment --><ul>
<li><b>fd</b>: File descriptor.</li>
<li><b>cmd</b>: Operation (e.g., <span class="tt">F_GETFL</span>, <span class="tt">F_SETFL</span>).</li>
<li><b>... (arg)</b>: Optional argument, typically <span class="tt">int</span> or a pointer (e.g., <span class="tt">struct flock</span> for locking).</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md242"></a>
Common Commands</h3>
<ul>
<li><b>File Status</b>:<ul>
<li><span class="tt">F_GETFL</span>: Get file status flags (e.g., <span class="tt">O_NONBLOCK</span>).</li>
<li><span class="tt">F_SETFL</span>: Set flags (e.g., enable <span class="tt">O_NONBLOCK</span>).</li>
</ul>
</li>
<li><b>File Locking</b>:<ul>
<li><span class="tt">F_GETLK</span>: Test a lock.</li>
<li><span class="tt">F_SETLK</span>: Set or clear a lock.</li>
<li><span class="tt">F_SETLKW</span>: Set lock, wait if blocked.</li>
</ul>
</li>
<li><b>Descriptor Management</b>:<ul>
<li><span class="tt">F_DUPFD</span>: Duplicate descriptor.</li>
<li><span class="tt">F_GETFD</span>/<span class="tt">F_SETFD</span>: Get/set close-on-exec flag (<span class="tt">FD_CLOEXEC</span>).</li>
</ul>
</li>
<li><b>Socket-Specific</b> (overlaps with <span class="tt">ioctl</span>):<ul>
<li><span class="tt">FIONBIO</span>: Set/clear non-blocking mode.</li>
<li><span class="tt">FIONREAD</span>: Get readable bytes.</li>
<li><span class="tt">FIOASYNC</span>: Enable/disable async I/O.</li>
</ul>
</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md243"></a>
Return Values</h3>
<ul>
<li><b>Success</b>: Varies (e.g., flags for <span class="tt">F_GETFL</span>, 0 for <span class="tt">F_SETFL</span>).</li>
<li><b>Failure</b>: -1, with <span class="tt">errno</span> (e.g., <span class="tt">EBADF</span>, <span class="tt">EINVAL</span>).</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md244"></a>
Common Errors</h3>
<ul>
<li><span class="tt">EBADF</span>: Invalid <span class="tt">fd</span>.</li>
<li><span class="tt">EINVAL</span>: Invalid <span class="tt">cmd</span> or <span class="tt">arg</span>.</li>
<li><span class="tt">EAGAIN</span>/<span class="tt">EACCES</span>: Lock conflicts.</li>
<li><span class="tt">ENOLCK</span>: No lock resources.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md245"></a>
Use Cases</h3>
<ul>
<li><b>File Locking</b>: Advisory locking for multi-process file access.</li>
<li><b>Non-Blocking I/O</b>: Setting <span class="tt">O_NONBLOCK</span> for sockets or pipes.</li>
<li><b>Descriptor Management</b>: Duplicating or setting close-on-exec.</li>
<li><b>Signal-Driven I/O</b>: Enabling <span class="tt">FIOASYNC</span> for notifications.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md246"></a>
Example: Set Non-Blocking Socket (Linux)</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    <span class="keywordtype">int</span> s = socket(AF_INET, SOCK_STREAM, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (s &lt; 0) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;socket&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">int</span> flags = fcntl(s, F_GETFL, 0);</div>
<div class="line">    <span class="keywordflow">if</span> (flags == -1) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;fcntl get&quot;</span>);</div>
<div class="line">        close(s);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (fcntl(s, F_SETFL, flags | O_NONBLOCK) == -1) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;fcntl set&quot;</span>);</div>
<div class="line">        close(s);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Socket set to non-blocking\n&quot;</span>);</div>
<div class="line">    close(s);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md247"></a>
Windows Support</h3>
<p><span class="tt">fcntl</span> is not supported on Windows. Windows uses <span class="tt">ioctlsocket</span> or <span class="tt">WSAIoctl</span> for socket operations and <span class="tt">CreateFile</span>/ <span class="tt">DeviceIoControl</span> for file/device control.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md248"></a>
Notes</h3>
<ul>
<li><b>Portability</b>: POSIX-compliant, more portable than <span class="tt">ioctl</span>.</li>
<li><b>Overlap with ioctl</b>: For sockets, <span class="tt">FIONBIO</span> and <span class="tt">FIONREAD</span> are identical in <span class="tt">fcntl</span> and <span class="tt">ioctl</span>.</li>
<li><b>Best Practice</b>: Use <span class="tt">fcntl</span> for non-blocking settings over <span class="tt">ioctl</span> for portability.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md250"></a>
3. ioctlsocket (Windows)</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md251"></a>
Description</h3>
<p><span class="tt">ioctlsocket</span> is a Winsock function for controlling socket I/O modes, providing BSD-compatible socket operations. It’s a subset of Unix <span class="tt">ioctl</span> for sockets, supporting commands like non-blocking mode or readable data queries. It requires Winsock initialization via <span class="tt">WSAStartup</span>.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md252"></a>
Syntax</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;winsock2.h&gt;</span></div>
<div class="line"><span class="keywordtype">int</span> ioctlsocket(SOCKET s, <span class="keywordtype">long</span> cmd, u_long *argp);</div>
</div><!-- fragment --><ul>
<li><b>s</b>: Socket descriptor.</li>
<li><b>cmd</b>: Command (e.g., <span class="tt">FIONBIO</span>).</li>
<li><b>argp</b>: Pointer to input/output parameter.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md253"></a>
Common Commands</h3>
<ul>
<li><b>FIONBIO</b>: Enable/disable non-blocking mode (<span class="tt">*argp</span> non-zero to enable).</li>
<li><b>FIONREAD</b>: Get bytes available to read.</li>
<li><b>SIOCATMARK</b>: Check if out-of-band (OOB) data is available.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md254"></a>
Return Values</h3>
<ul>
<li><b>Success</b>: 0.</li>
<li><b>Failure</b>: <span class="tt">SOCKET_ERROR</span> (-1); use <span class="tt">WSAGetLastError</span> for codes like <span class="tt">WSAENOTSOCK</span>, <span class="tt">WSAEFAULT</span>.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md255"></a>
Common Errors</h3>
<ul>
<li><span class="tt">WSANOTINITIALISED</span>: Winsock not initialized.</li>
<li><span class="tt">WSAENETDOWN</span>: Network subsystem failed.</li>
<li><span class="tt">WSAENOTSOCK</span>: Invalid socket.</li>
<li><span class="tt">WSAEFAULT</span>: Invalid <span class="tt">argp</span>.</li>
<li><span class="tt">WSAEINVAL</span>: Invalid <span class="tt">cmd</span> or <span class="tt">argp</span>.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md256"></a>
Use Cases</h3>
<ul>
<li><b>Non-Blocking Sockets</b>: Enabling <span class="tt">FIONBIO</span> for asynchronous I/O.</li>
<li><b>Data Queries</b>: Checking readable bytes with <span class="tt">FIONREAD</span>.</li>
<li><b>OOB Data</b>: Handling urgent data with <span class="tt">SIOCATMARK</span>.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md257"></a>
Example: Non-Blocking Socket (Windows)</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;winsock2.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    WSADATA wsaData;</div>
<div class="line">    <span class="keywordflow">if</span> (WSAStartup(MAKEWORD(2,2), &amp;wsaData) != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;WSAStartup failed: %d\n&quot;</span>, WSAGetLastError());</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    SOCKET s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</div>
<div class="line">    <span class="keywordflow">if</span> (s == INVALID_SOCKET) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;socket failed: %d\n&quot;</span>, WSAGetLastError());</div>
<div class="line">        WSACleanup();</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    u_long iMode = 1; <span class="comment">// Non-blocking</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespacejsocketpp.html#a771a44f3967222b2e3221ed3120220af">ioctlsocket</a>(s, FIONBIO, &amp;iMode) != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;ioctlsocket failed: %d\n&quot;</span>, WSAGetLastError());</div>
<div class="line">        closesocket(s);</div>
<div class="line">        WSACleanup();</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Socket set to non-blocking\n&quot;</span>);</div>
<div class="line">    closesocket(s);</div>
<div class="line">    WSACleanup();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="anamespacejsocketpp_html_a771a44f3967222b2e3221ed3120220af"><div class="ttname"><a href="namespacejsocketpp.html#a771a44f3967222b2e3221ed3120220af">jsocketpp::ioctlsocket</a></div><div class="ttdeci">int ioctlsocket(const SOCKET fd, const long cmd, u_long *argp)</div><div class="ttdef"><b>Definition</b> common.hpp:287</div></div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md258"></a>
Windows Support</h3>
<ul>
<li><b>Windows XP</b>: Fully supported (introduced in Windows Sockets 2.0, available since Windows 95/NT 4.0).</li>
<li><b>Later Versions</b>: Supported in all subsequent versions (Vista, 7, 8, 8.1, 10, 11, Server 2003–2022).</li>
<li><b>Requirements</b>: <span class="tt">Ws2_32.lib</span>, <span class="tt">Ws2_32.dll</span>.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md259"></a>
Notes</h3>
<ul>
<li><b>Limitations</b>: Fewer commands than Unix <span class="tt">ioctl</span>; lacks <span class="tt">FIOASYNC</span> equivalent.</li>
<li><b>Alternative</b>: <span class="tt">WSAIoctl</span> for extended functionality.</li>
<li><b>Compatibility</b>: Aligns with BSD socket ioctls but requires <span class="tt">WSAStartup</span>.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md261"></a>
4. WSAIoctl (Windows)</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md262"></a>
Description</h3>
<p><span class="tt">WSAIoctl</span> is a more powerful Winsock function, extending <span class="tt">ioctlsocket</span> with support for Windows-specific and BSD-compatible socket operations. It handles a broader range of commands, including network interface control, QoS, and provider-specific extensions.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md263"></a>
Syntax</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;winsock2.h&gt;</span></div>
<div class="line"><span class="keywordtype">int</span> WSAIoctl(</div>
<div class="line">    SOCKET s,</div>
<div class="line">    DWORD dwIoControlCode,</div>
<div class="line">    LPVOID lpvInBuffer,</div>
<div class="line">    DWORD cbInBuffer,</div>
<div class="line">    LPVOID lpvOutBuffer,</div>
<div class="line">    DWORD cbOutBuffer,</div>
<div class="line">    LPDWORD lpcbBytesReturned,</div>
<div class="line">    LPWSAOVERLAPPED lpOverlapped,</div>
<div class="line">    LPWSAOVERLAPPED_COMPLETION_ROUTINE lpCompletionRoutine</div>
<div class="line">);</div>
</div><!-- fragment --><ul>
<li><b>s</b>: Socket descriptor.</li>
<li><b>dwIoControlCode</b>: 32-bit control code (e.g., <span class="tt">SIO_GET_INTERFACE_LIST</span>).</li>
<li><b>lpvInBuffer</b>, <b>cbInBuffer</b>: Input buffer and size.</li>
<li><b>lpvOutBuffer</b>, <b>cbOutBuffer</b>: Output buffer and size.</li>
<li><b>lpcbBytesReturned</b>: Bytes written to output buffer.</li>
<li><b>lpOverlapped</b>, <b>lpCompletionRoutine</b>: For asynchronous operation (optional).</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md264"></a>
Common Commands</h3>
<ul>
<li><b>BSD-Compatible</b>:<ul>
<li><span class="tt">FIONBIO</span>, <span class="tt">FIONREAD</span>, <span class="tt">SIOCATMARK</span> (same as <span class="tt">ioctlsocket</span>).</li>
</ul>
</li>
<li><b>Windows-Specific</b>:<ul>
<li><span class="tt">SIO_RCVALL</span>: Enable promiscuous mode (raw sockets).</li>
<li><span class="tt">SIO_KEEPALIVE_VALS</span>: Configure TCP keep-alive.</li>
<li><span class="tt">SIO_GET_INTERFACE_LIST</span>: List network interfaces.</li>
<li><span class="tt">SIO_ADDRESS_LIST_QUERY</span>: Get local addresses.</li>
<li><span class="tt">SIO_ROUTING_INTERFACE_QUERY</span>: Get routing interface.</li>
</ul>
</li>
<li><b>QoS and Extensions</b>:<ul>
<li><span class="tt">SIO_SET_QOS</span>: Set Quality of Service parameters.</li>
<li><span class="tt">SIO_GET_EXTENSION_FUNCTION_POINTER</span>: Retrieve function pointers for Winsock extensions.</li>
</ul>
</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md265"></a>
Return Values</h3>
<ul>
<li><b>Success</b>: 0; <span class="tt">lpcbBytesReturned</span> indicates output size.</li>
<li><b>Failure</b>: <span class="tt">SOCKET_ERROR</span>; use <span class="tt">WSAGetLastError</span>.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md266"></a>
Common Errors</h3>
<ul>
<li>Similar to <span class="tt">ioctlsocket</span>, plus:<ul>
<li><span class="tt">WSAEINVAL</span>: Invalid buffer sizes or control code.</li>
<li><span class="tt">WSAEFAULT</span>: Invalid buffer pointers.</li>
<li><span class="tt">WSAEOPNOTSUPP</span>: Unsupported operation.</li>
</ul>
</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md267"></a>
Use Cases</h3>
<ul>
<li><b>Network Monitoring</b>: <span class="tt">SIO_RCVALL</span> for packet sniffing (requires admin privileges).</li>
<li><b>Interface Management</b>: Querying interfaces with <span class="tt">SIO_GET_INTERFACE_LIST</span>.</li>
<li><b>Advanced Socket Config</b>: Keep-alive settings or QoS.</li>
<li><b>Extensibility</b>: Accessing Winsock extension functions.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md268"></a>
Example: Get Interface List (Windows)</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;winsock2.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ws2tcpip.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    WSADATA wsaData;</div>
<div class="line">    <span class="keywordflow">if</span> (WSAStartup(MAKEWORD(2,2), &amp;wsaData) != 0) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;WSAStartup failed: %d\n&quot;</span>, WSAGetLastError());</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    SOCKET s = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);</div>
<div class="line">    <span class="keywordflow">if</span> (s == INVALID_SOCKET) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;socket failed: %d\n&quot;</span>, WSAGetLastError());</div>
<div class="line">        WSACleanup();</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordtype">char</span> buffer[1024];</div>
<div class="line">    DWORD bytesReturned;</div>
<div class="line">    <span class="keywordflow">if</span> (WSAIoctl(s, SIO_GET_INTERFACE_LIST, NULL, 0, buffer, <span class="keyword">sizeof</span>(buffer), &amp;bytesReturned, NULL, NULL) == SOCKET_ERROR) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;WSAIoctl failed: %d\n&quot;</span>, WSAGetLastError());</div>
<div class="line">        closesocket(s);</div>
<div class="line">        WSACleanup();</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    INTERFACE_INFO *pInfo = (INTERFACE_INFO *)buffer;</div>
<div class="line">    <span class="keywordtype">int</span> count = bytesReturned / <span class="keyword">sizeof</span>(INTERFACE_INFO);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; count; i++) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;Interface %d: Flags=0x%lx\n&quot;</span>, i, pInfo[i].iiFlags);</div>
<div class="line">    }</div>
<div class="line">    closesocket(s);</div>
<div class="line">    WSACleanup();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md269"></a>
Windows Support</h3>
<ul>
<li><b>Windows XP</b>: Supported (introduced in Winsock 2.0, available since Windows 95/NT 4.0).</li>
<li><b>Later Versions</b>: Supported in Vista, 7, 8, 8.1, 10, 11, Server 2003–2022.</li>
<li><b>Requirements</b>: <span class="tt">Ws2_32.lib</span>, <span class="tt">Ws2_32.dll</span>.</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md270"></a>
Notes</h3>
<ul>
<li><b>Superset of ioctlsocket</b>: Handles all <span class="tt">ioctlsocket</span> commands plus more.</li>
<li><b>Asynchronous Support</b>: Uses overlapped I/O for scalability.</li>
<li><b>Extensibility</b>: Supports vendor-specific codes via <span class="tt">SIO_GET_EXTENSION_FUNCTION_POINTER</span>.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md272"></a>
5. Related Functions</h2>
<h3 class="doxsection"><a class="anchor" id="autotoc_md273"></a>
setsockopt/getsockopt</h3>
<ul>
<li><b>Description</b>: Set/get socket options (e.g., <span class="tt">SO_REUSEADDR</span>, <span class="tt">SO_KEEPALIVE</span>). More portable than <span class="tt">ioctl</span>/ <span class="tt">ioctlsocket</span> for socket configuration.</li>
<li><b>Use Cases</b>: Setting timeouts, buffer sizes, or enabling keep-alive.</li>
<li><b>Commands</b>:<ul>
<li><span class="tt">SO_REUSEADDR</span>: Reuse local addresses.</li>
<li><span class="tt">SO_LINGER</span>: Control socket close behavior.</li>
<li><span class="tt">SO_SNDBUF</span>/<span class="tt">SO_RCVBUF</span>: Set buffer sizes.</li>
</ul>
</li>
<li><b>Windows Support</b>: Fully supported in Windows XP and later (Winsock 1.1+).</li>
<li><b>Example</b>:</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;winsock2.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    WSADATA wsaData;</div>
<div class="line">    WSAStartup(MAKEWORD(2,2), &amp;wsaData);</div>
<div class="line">    SOCKET s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</div>
<div class="line">    <span class="keywordtype">int</span> enable = 1;</div>
<div class="line">    <span class="keywordflow">if</span> (setsockopt(s, SOL_SOCKET, SO_REUSEADDR, (<span class="keywordtype">char</span> *)&amp;enable, <span class="keyword">sizeof</span>(enable)) == SOCKET_ERROR) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;setsockopt failed: %d\n&quot;</span>, WSAGetLastError());</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        printf(<span class="stringliteral">&quot;SO_REUSEADDR enabled\n&quot;</span>);</div>
<div class="line">    }</div>
<div class="line">    closesocket(s);</div>
<div class="line">    WSACleanup();</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md274"></a>
tcsetattr/tcgetattr</h3>
<ul>
<li><b>Description</b>: POSIX functions for terminal attribute control (e.g., baud rate, echo). Replaces <span class="tt">ioctl</span> for terminal settings in portable code.</li>
<li><b>Use Cases</b>: Configuring serial ports or terminal modes.</li>
<li><b>Windows Support</b>: Not supported; use Windows Console API (<span class="tt">SetConsoleMode</span>).</li>
<li><b>Example</b> (Unix):</li>
</ul>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;termios.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="client_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    <span class="keyword">struct </span>termios term;</div>
<div class="line">    <span class="keywordflow">if</span> (tcgetattr(STDIN_FILENO, &amp;term) == -1) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;tcgetattr&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    term.c_lflag &amp;= ~ECHO; <span class="comment">// Disable echo</span></div>
<div class="line">    <span class="keywordflow">if</span> (tcsetattr(STDIN_FILENO, TCSANOW, &amp;term) == -1) {</div>
<div class="line">        perror(<span class="stringliteral">&quot;tcsetattr&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Echo disabled\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="autotoc_md275"></a>
DeviceIoControl (Windows)</h3>
<ul>
<li><b>Description</b>: Windows equivalent to <span class="tt">ioctl</span> for device control, used with file handles.</li>
<li><b>Use Cases</b>: Controlling drivers (e.g., USB, disk).</li>
<li><b>Windows Support</b>: Supported in Windows XP and later (Win32 API).</li>
<li><b>Example</b>: Not provided due to complexity; see MSDN for <span class="tt">IOCTL_DISK_GET_DRIVE_GEOMETRY</span>.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md277"></a>
Windows Version Support Summary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Function  </th><th class="markdownTableHeadNone">Windows XP  </th><th class="markdownTableHeadNone">Vista  </th><th class="markdownTableHeadNone">7  </th><th class="markdownTableHeadNone">8/8.1  </th><th class="markdownTableHeadNone">10/11  </th><th class="markdownTableHeadNone">Server 2003–2022  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>ioctl</b>  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>fcntl</b>  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>ioctlsocket</b>  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>WSAIoctl</b>  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>setsockopt</b>  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>getsockopt</b>  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>tcsetattr/tcgetattr</b>  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td><td class="markdownTableBodyNone">Not supported  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>DeviceIoControl</b>  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td><td class="markdownTableBodyNone">Supported  </td></tr>
</table>
<ul>
<li><b>Windows XP</b>: Supports Winsock 2.0 (<span class="tt">ioctlsocket</span>, <span class="tt">WSAIoctl</span>, <span class="tt">setsockopt</span>, <span class="tt">getsockopt</span>) and <span class="tt">DeviceIoControl</span>. Unix functions (<span class="tt">ioctl</span>, <span class="tt">fcntl</span>, <span class="tt">tcsetattr</span>) are unavailable; use Cygwin/MSYS2 for partial emulation.</li>
<li><b>Later Versions</b>: No changes in core functionality; additional <span class="tt">WSAIoctl</span> commands (e.g., <span class="tt">SIO_BSP_HANDLE</span>) added in newer versions.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md279"></a>
Detailed Notes</h2>
<ul>
<li><b>Portability</b>: Use <span class="tt">fcntl</span> or <span class="tt">setsockopt</span> for socket operations in cross-platform code. <span class="tt">ioctl</span> and <span class="tt">WSAIoctl</span> are less portable due to device-specific commands.</li>
<li><b>Security</b>: Kernel-side <span class="tt">ioctl</span> handlers must validate inputs to prevent crashes or privilege escalation. User-space <span class="tt">WSAIoctl</span> requires admin privileges for some commands (e.g., <span class="tt">SIO_RCVALL</span>).</li>
<li><b>Alternatives</b>: In Linux, sysfs or netlink reduce <span class="tt">ioctl</span> usage. In Windows, <span class="tt">WSAIoctl</span> is preferred over <span class="tt">ioctlsocket</span> for new code.</li>
<li><b>Performance</b>: <span class="tt">ioctl</span> and <span class="tt">WSAIoctl</span> involve kernel/user transitions, so minimize calls in hot paths.</li>
<li><b>Historical Context</b>: <span class="tt">ioctl</span> originated in Unix V7; <span class="tt">ioctlsocket</span> was introduced for BSD socket compatibility in Windows. <span class="tt">WSAIoctl</span> added Windows-specific extensions.</li>
</ul>
<hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md281"></a>
Practical Considerations</h2>
<ul>
<li><b>Debugging</b>: Always check return values and error codes (<span class="tt">errno</span> or <span class="tt">WSAGetLastError</span>). <span class="tt">ENOTTY</span> in Unix often indicates an inapplicable command.</li>
<li><b>Thread Safety</b>: <span class="tt">ioctl</span> and <span class="tt">fcntl</span> are thread-safe but may have race conditions with shared descriptors. <span class="tt">ioctlsocket</span> and <span class="tt">WSAIoctl</span> are safe after <span class="tt">WSAStartup</span>.</li>
<li><b>Windows XP</b>: Ensure Winsock 2.2 for full <span class="tt">WSAIoctl</span> support; older versions may lack some commands.</li>
<li><b>Cross-Platform Code</b>: Use libraries like <span class="tt">libuv</span> or <span class="tt">Boost.Asio</span> to abstract differences. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
